#!/bin/bash

# ============================================================
# è„šæœ¬åç§°: dir-to-rar.sh
# åŠŸèƒ½: æ‰¹é‡æ–‡ä»¶å¤¹æ‰“åŒ…ï¼Œæ”¯æŒè‡ªå®šä¹‰æ³¨é‡Šå†…å®¹ã€ä¸­æ–‡å¯†ç ã€æ¢å¤è®°å½•
# ä¾èµ–å·¥å…·: rar
# ä½¿ç”¨å‰è¯·ç¡®ä¿å·²å®‰è£… rar å·¥å…· (e.g., sudo apt install rar)
#
# è„šæœ¬ä¼šéå†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å­æ–‡ä»¶å¤¹ï¼Œ
# å¹¶å°†æ¯ä¸ªæ–‡ä»¶å¤¹å‹ç¼©ä¸ºåŒåçš„ RAR æ–‡ä»¶ï¼Œ
# å‹ç¼©åŒ…å†…å®¹ä¸åŒ…å«è·¯å¾„å±‚çº§ï¼Œ
# å¹¶æ·»åŠ è‡ªå®šä¹‰æ³¨é‡Šã€å¯†ç ä¿æŠ¤åŠæ¢å¤è®°å½•ã€‚
# 
# æ³¨æ„: è„šæœ¬ä¸ä¼šåˆ é™¤åŸå§‹æ–‡ä»¶å¤¹ï¼Œè¯·æ ¹æ®éœ€è¦è‡ªè¡Œå¤„ç†ã€‚
# æœ¬äººè‡ªåˆ†äº«ç”¨ï¼Œè¯·è‡ªè¡Œä¿®æ”¹å¯¹åº”éƒ¨åˆ†ä»¥é€‚åº”ä½ çš„éœ€æ±‚ã€‚
# ============================================================

# --- ğŸ·ï¸ ä¸ªæ€§åŒ–é…ç½®åŒºåŸŸ ---
# 1. èµ„æºä¿¡æ¯
COLLECTION_NAME="Essential Collection" # èµ„æºåˆé›†åç§°
SOURCE_FROM="äº’è”ç½‘æ”¶é›†" # èµ„æºæ¥æº
ARRANGED_BY="èŠ¹èœP"  # æ•´ç†å°è£…è€…
MY_URL="github.com/nutserina" # ä¸ªäººä¸»é¡µ

# 2. å®‰å…¨ä¸æ¢å¤
PASS="ç°å§‘å¨˜å¥³å­©"         # è§£å‹å¯†ç  (æ”¯æŒä¸­æ–‡)
RECOVERY_PERCENT=5       # æ¢å¤è®°å½•ç™¾åˆ†æ¯”

# 3. æç¤ºè¯­è¨€
TIPS="æ¸©é¦¨æç¤ºï¼šè¯·ä½¿ç”¨ WinRAR 5.0 æˆ–æ›´é«˜ç‰ˆæœ¬è¿›è¡Œè§£å‹ã€‚"
RECOVERY_TIPS="æ•°æ®åŒ…å« ${RECOVERY_PERCENT}% æ¢å¤è®°å½•ï¼Œå¦‚é‡æŸåè¯·å°è¯•ä¿®å¤ã€‚"
# -----------------------

# æ£€æŸ¥ä¾èµ–
if ! command -v rar &> /dev/null; then
    echo "âŒ é”™è¯¯: æœªæ£€æµ‹åˆ° 'rar' å‘½ä»¤ã€‚è¯·å…ˆå®‰è£… (e.g., sudo apt install rar)"
    exit 1
fi

# åŠ¨æ€ç”Ÿæˆæ³¨é‡Šæ–‡ä»¶
TMP_COMMENT="comment_tmp.txt"
cat << EOF > "$TMP_COMMENT"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ $(printf "%-48s" "$COLLECTION_NAME") â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— èµ„æºæ¥æºï¼š$SOURCE_FROM
â”‚ â— æ•´ç†å°è£…ï¼š$ARRANGED_BY
â”‚ â— ä¸ªäººä¸»é¡µï¼š$MY_URL
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ è§£å‹å¯†ç ï¼š$PASS
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  $TIPS
  $RECOVERY_TIPS
EOF

# å¯†ç å‚æ•° (ä½¿ç”¨ -p ä½¿æ³¨é‡Šå¯è§)
PASS_OPT=$([ -n "$PASS" ] && echo "-p$PASS" || echo "")

echo "ğŸš€ easier-linux: æ­£åœ¨å¼€å§‹æ‰¹é‡æ‰“åŒ…..."

# åªéå†æ–‡ä»¶å¤¹
for dir in */; do
    # æå–ç›®å½•å
    folder_name="${dir%/}"
    
    # åŸºç¡€è¿‡æ»¤
    [ "$folder_name" == "." ] || [ "$folder_name" == ".." ] && continue

    echo "ğŸ“¦ æ­£åœ¨å‹ç¼©: $folder_name"

    # æ‰§è¡Œå‹ç¼©ä»»åŠ¡
    # -p: å¯†ç  (å†…å®¹åŠ å¯†, æ³¨é‡Šå¯è§)
    # -rr: æ·»åŠ æ¢å¤è®°å½•
    # -z: å¯¼å…¥æ³¨é‡Š
    # -ep1: æ’é™¤è·¯å¾„å±‚çº§
    # -m3: æ ‡å‡†å‹ç¼©é€Ÿç‡ (å¯æ”¹ä¸º -m5 ä»¥è·å¾—æ›´é«˜å‹ç¼©ç‡)
    rar a -r "-rr${RECOVERY_PERCENT}p" "$PASS_OPT" -z"$TMP_COMMENT" -ep1 "${folder_name}.rar" "$dir" > /dev/null

    if [ $? -eq 0 ]; then
        echo "âœ… æˆåŠŸ: ${folder_name}.rar"
    else
        echo "âŒ å¤±è´¥: $folder_name"
    fi
done

# å½»åº•æ¸…ç†ä¸´æ—¶æ–‡ä»¶
[ -f "$TMP_COMMENT" ] && rm "$TMP_COMMENT"

echo "------------------------------------------------"
echo "âœ¨ æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼"